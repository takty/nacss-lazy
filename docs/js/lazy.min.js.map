{"version":3,"sources":["lazy.js"],"names":["window","NS","hide","t","blankImage","saveAttribute","style","opacity","h","getAttribute","minHeight","show","addEventListener","restoreAttribute","lazyImage","ts","opts","length","Object","assign","offset","isPolyfillNeeded","HTMLImageElement","prototype","onIntersect","vs","i","dataset","src","setAttribute","lazyImageIsNeeded","v","contentDocument","location","replace","lazyIframe","HTMLIFrameElement","lazyIframeIsNeeded","resizeListeners","onResize","fn","doFirst","push","isRunning","args","requestAnimationFrame","throttle","targets","threshold","rootMargin","Array","fill","tm","Map","forEach","set","mt","io","st","s","getComputedStyle","document","documentElement","parseInt","scrollPaddingTop","getScrollOffset","clearTimeout","setTimeout","disconnect","IntersectionObserver","es","e","get","target","isIntersecting","observe","init","at","alt","removeAttribute","proto","l","passive"],"mappings":"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","file":"lazy.min.js","sourcesContent":["/**\r\n *\r\n * Lazy Loading\r\n *\r\n * @author Takuto Yanagida\r\n * @version 2021-11-11\r\n *\r\n */\r\n\r\n\r\nwindow['NACSS'] = window['NACSS'] || {};\r\n\r\n\r\n(function (NS) {\r\n\r\n\t(function () {\r\n\t\t/**\r\n\t\t *\r\n\t\t * Image\r\n\t\t *\r\n\t\t * @author Takuto Yanagida\r\n\t\t * @version 2021-11-11\r\n\t\t *\r\n\t\t */\r\n\t\t\r\n\t\t\r\n\t\tconst BLANK_IMG = 'data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=';\r\n\t\t\r\n\t\t\r\n\t\tfunction initialize(ts, opts = {}) {\r\n\t\t\tif (ts.length === 0) return;\r\n\t\t\r\n\t\t\topts = Object.assign({\r\n\t\t\t\toffset    : 100,\r\n\t\t\t\tblankImage: BLANK_IMG,\r\n\t\t\t}, opts);\r\n\t\t\r\n\t\t\tif (isPolyfillNeeded(HTMLImageElement.prototype)) {  // For Safari\r\n\t\t\t\tfor (const t of ts) {\r\n\t\t\t\t\thide(t, opts['blankImage']);\r\n\t\t\t\t}\r\n\t\t\t\tonIntersect(vs => {\r\n\t\t\t\t\tfor (let i = 0; i < ts.length; i += 1) {\r\n\t\t\t\t\t\tconst t = ts[i];\r\n\t\t\t\t\t\tif (t.dataset.src && vs[i]) {\r\n\t\t\t\t\t\t\tshow(t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, ts, 0, `* 0px ${opts['offset']}px 0px`);\r\n\t\t\t}\r\n\t\t\r\n\t\t\twindow.addEventListener('beforeprint', () => {\r\n\t\t\t\tfor (const t of ts) {\r\n\t\t\t\t\tif (t.dataset.src) {\r\n\t\t\t\t\t\tshow(t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (t.getAttribute('loading') === 'lazy') {\r\n\t\t\t\t\t\tt.setAttribute('loading', 'eager');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, false);\r\n\t\t}\r\n\t\t\r\n\t\tfunction hide(t, blankImage) {\r\n\t\t\tsaveAttribute(t, 'src', blankImage);\r\n\t\t\tsaveAttribute(t, 'srcset');\r\n\t\t\tt.style.opacity = 0;\r\n\t\t\tconst h = t.getAttribute('height');\r\n\t\t\tif (h) {\r\n\t\t\t\tt.style.minHeight = h + 'px';\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction show(t) {\r\n\t\t\tt.addEventListener('load', () => {\r\n\t\t\t\tt.style.minHeight = '';\r\n\t\t\t\tt.style.opacity   = '';\r\n\t\t\t});\r\n\t\t\trestoreAttribute(t, 'src');\r\n\t\t\trestoreAttribute(t, 'srcset');\r\n\t\t}\r\n\t\t\r\n\t\tNS.lazyImage         = initialize;\r\n\t\tNS.lazyImageIsNeeded = isPolyfillNeeded;\r\n\t})();\r\n\r\n\t(function () {\r\n\t\t/**\r\n\t\t *\r\n\t\t * Iframe\r\n\t\t *\r\n\t\t * @author Takuto Yanagida\r\n\t\t * @version 2021-11-19\r\n\t\t *\r\n\t\t */\r\n\t\t\r\n\t\t\r\n\t\tfunction initialize(ts, opts = {}) {\r\n\t\t\tif (ts.length === 0) return;\r\n\t\t\r\n\t\t\topts = Object.assign({\r\n\t\t\t\toffset: 100,\r\n\t\t\t}, opts);\r\n\t\t\r\n\t\t\tif (isPolyfillNeeded(HTMLIFrameElement.prototype)) {  // For Safari\r\n\t\t\t\tfor (const t of ts) {\r\n\t\t\t\t\thide(t);\r\n\t\t\t\t}\r\n\t\t\t\tonIntersect(vs => {\r\n\t\t\t\t\tfor (let i = 0; i < ts.length; i += 1) {\r\n\t\t\t\t\t\tconst t = ts[i];\r\n\t\t\t\t\t\tif (t.dataset.src && vs[i]) {\r\n\t\t\t\t\t\t\tshow(t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, ts, 0, `* 0px ${opts['offset']}px 0px`);\r\n\t\t\t}\r\n\t\t\r\n\t\t\twindow.addEventListener('beforeprint', () => {\r\n\t\t\t\tfor (const t of ts) {\r\n\t\t\t\t\tif (t.dataset.src) {\r\n\t\t\t\t\t\tshow(t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (t.getAttribute('loading') === 'lazy') {\r\n\t\t\t\t\t\tt.setAttribute('loading', 'eager');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, false);\r\n\t\t}\r\n\t\t\r\n\t\tfunction hide(t) {\r\n\t\t\tsaveAttribute(t, 'src');\r\n\t\t}\r\n\t\t\r\n\t\tfunction show(t) {\r\n\t\t\tconst v = t.dataset['src'];\r\n\t\t\tif (v) {\r\n\t\t\t\tt.contentDocument.location.replace(v);\r\n\t\t\t\tdelete t.dataset['src'];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tNS.lazyIframe         = initialize;\r\n\t\tNS.lazyIframeIsNeeded = isPolyfillNeeded;\r\n\t})();\r\n\r\n\t/**\r\n\t *\r\n\t * Style Class Utilities\r\n\t *\r\n\t * @author Takuto Yanagida\r\n\t * @version 2021-11-11\r\n\t *\r\n\t */\r\n\t\r\n\t\r\n\tfunction hasClass(tar, cls) {\r\n\t\tconst key = cls.substr(1);\r\n\t\tif (cls.startsWith(':')) {\r\n\t\t\treturn tar.dataset[key] !== undefined;\r\n\t\t} else {\r\n\t\t\treturn tar.classList.contains(key);\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction setClass(tar, cls, enabled = true, val = '') {\r\n\t\tconst key = cls.substr(1);\r\n\t\tif (cls.startsWith(':')) {\r\n\t\t\tif (enabled) {\r\n\t\t\t\ttar.dataset[key] = val;\r\n\t\t\t} else {\r\n\t\t\t\tdelete tar.dataset[key];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst c = [key, val].join('-');\r\n\t\t\tif (enabled) {\r\n\t\t\t\ttar.classList.add(c);\r\n\t\t\t} else {\r\n\t\t\t\ttar.classList.remove(c);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction getSelector(cls) {\r\n\t\tif (cls.startsWith(':')) {\r\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\r\n\t\t} else {\r\n\t\t\treturn `*${cls}`;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t * Utilities\r\n\t *\r\n\t * @author Takuto Yanagida\r\n\t * @version 2021-11-17\r\n\t *\r\n\t */\r\n\t\r\n\t\r\n\tfunction getScrollOffset() {\r\n\t\tconst s = getComputedStyle(document.documentElement);\r\n\t\treturn parseInt(s.scrollPaddingTop);\r\n\t}\r\n\t\r\n\t\r\n\t// -----------------------------------------------------------------------------\r\n\t\r\n\t\r\n\tfunction throttle(fn) {\r\n\t\tlet isRunning;\r\n\t\treturn (...args) => {\r\n\t\t\tif (isRunning) return;\r\n\t\t\tisRunning = true;\r\n\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\tisRunning = false;\r\n\t\t\t\tfn(...args);\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\t\r\n\tconst resizeListeners = [];\r\n\t\r\n\tfunction onResize(fn, doFirst = false) {\r\n\t\tif (doFirst) fn();\r\n\t\tresizeListeners.push(throttle(fn));\r\n\t}\r\n\t\r\n\tdocument.addEventListener('DOMContentLoaded', () => {\r\n\t\twindow.addEventListener('resize', () => {\r\n\t\t\tfor (const l of resizeListeners) l();\r\n\t\t}, { passive: true });\r\n\t});\r\n\t\r\n\t\r\n\t// -----------------------------------------------------------------------------\r\n\t\r\n\t\r\n\tfunction onIntersect(fn, targets, threshold = 0, rootMargin ='* 0px 0px 0px') {\r\n\t\tconst vs = Array(targets.length).fill(false);\r\n\t\tconst tm = new Map();\r\n\t\ttargets.forEach((t, i) => tm.set(t, i));\r\n\t\r\n\t\tfunction init() {\r\n\t\t\tconst io = new IntersectionObserver((es) => {\r\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\r\n\t\t\t\tfn(vs);\r\n\t\t\t}, { rootMargin: rootMargin.replace('*', `${mt}px`), threshold });\r\n\t\t\tfor (const t of targets) io.observe(t);\r\n\t\t\treturn io;\r\n\t\t}\r\n\t\tlet mt = 0;\r\n\t\tlet io = null;\r\n\t\tlet st = null;\r\n\t\tonResize(() => {\r\n\t\t\tmt = -getScrollOffset();\r\n\t\t\tif (st) clearTimeout(st);\r\n\t\t\tst = setTimeout(() => {\r\n\t\t\t\tif (io) io.disconnect();\r\n\t\t\t\tio = init();\r\n\t\t\t}, 100);\r\n\t\t}, true);\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t * Common Functions\r\n\t *\r\n\t * @author Takuto Yanagida\r\n\t * @version 2021-11-11\r\n\t *\r\n\t */\r\n\t\r\n\t\r\n\tfunction saveAttribute(t, at, alt = null) {\r\n\t\tconst v = t.getAttribute(at);\r\n\t\tif (v) {\r\n\t\t\tt.dataset[at] = v;\r\n\t\t\tif (alt) {\r\n\t\t\t\tt.setAttribute(at, alt);\r\n\t\t\t} else {\r\n\t\t\t\tt.removeAttribute(at);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction restoreAttribute(t, at) {\r\n\t\tconst v = t.dataset[at];\r\n\t\tif (v) {\r\n\t\t\tt.setAttribute(at, v);\r\n\t\t\tdelete t.dataset[at];\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction isPolyfillNeeded(proto) {\r\n\t\treturn (!('loading' in proto));\r\n\t}\r\n\t\r\n\r\n})(window['NACSS']);\r\n"]}