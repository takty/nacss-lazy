{"version":3,"sources":["delay.js"],"names":["window","NS","resizeListeners","onResize","fn","doFirst","push","isRunning","args","requestAnimationFrame","throttle","onIntersect","targets","threshold","rootMargin","vs","Array","length","fill","tm","Map","forEach","t","i","set","mt","io","st","s","getComputedStyle","document","documentElement","val","parseInt","scrollPaddingTop","Number","isNaN","getScrollOffset","clearTimeout","setTimeout","disconnect","IntersectionObserver","es","e","get","target","isIntersecting","replace","observe","init","addEventListener","l","passive","BLANK_IMG","apply","ts","opts","Object","assign","offset","blankImage","doForce","getAttribute","setAttribute","isPolyfillNeeded","HTMLImageElement","prototype","setPolyfill","filter","dataset","src","show","hide","saveAttribute","style","opacity","h","minHeight","restoreAttribute","applyImage","isPolyfillNeededForImage","HTMLIFrameElement","console","log","v","contentDocument","location","applyIframe","isPolyfillNeededForIframe","at","alt","removeAttribute","proto"],"mappings":"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","file":"delay.min.js","sourcesContent":["/**\n *\n * Delay Loading\n *\n * @author Takuto Yanagida\n * @version 2021-12-26\n *\n */\n\n\n'use strict';\n\nwindow['NACSS']          = window['NACSS']          || {};\nwindow['NACSS']['delay'] = window['NACSS']['delay'] || {};\n\n\n((NS) => {\n\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction onIntersect(fn, targets, threshold = 0, rootMargin ='* 0px 0px 0px') {\n\t\tconst vs = Array(targets.length).fill(false);\n\t\tconst tm = new Map();\n\t\ttargets.forEach((t, i) => tm.set(t, i));\n\t\n\t\tfunction init() {\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\n\t\t\t\tfn(vs);\n\t\t\t}, { rootMargin: rootMargin.replace('*', `${mt}px`), threshold });\n\t\t\tfor (const t of targets) io.observe(t);\n\t\t\treturn io;\n\t\t}\n\t\tlet mt = 0;\n\t\tlet io = null;\n\t\tlet st = null;\n\t\tonResize(() => {\n\t\t\tmt = -getScrollOffset();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\t{\n\t\t/**\n\t\t *\n\t\t * Image\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-12-26\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tconst BLANK_IMG = 'data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=';\n\t\t\n\t\t\n\t\tfunction apply(ts, opts = {}) {\n\t\t\tif (ts.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\toffset    : 100,\n\t\t\t\tblankImage: BLANK_IMG,\n\t\t\t\tdoForce   : true,\n\t\t\t}, opts);\n\t\t\n\t\t\tfor (const t of ts) {\n\t\t\t\tif (t.getAttribute('loading')) {\n\t\t\t\t\tt.setAttribute('loading', 'lazy');\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tif (isPolyfillNeeded(HTMLImageElement.prototype)) {  // For Safari\n\t\t\t\tsetPolyfill(ts, opts);\n\t\t\t} else if (opts['doForce']) {\n\t\t\t\tconst np = ts.filter(e => !e.getAttribute('loading'));\n\t\t\t\tsetPolyfill(np, opts);\n\t\t\t}\n\t\t\n\t\t\twindow.addEventListener('beforeprint', () => {\n\t\t\t\tfor (const t of ts) {\n\t\t\t\t\tif (t.dataset.src) {\n\t\t\t\t\t\tshow(t);\n\t\t\t\t\t}\n\t\t\t\t\tif (t.getAttribute('loading') === 'lazy') {\n\t\t\t\t\t\tt.setAttribute('loading', 'eager');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, false);\n\t\t}\n\t\t\n\t\tfunction setPolyfill(ts, opts) {\n\t\t\tfor (const t of ts) {\n\t\t\t\thide(t, opts['blankImage']);\n\t\t\t}\n\t\t\tonIntersect(vs => {\n\t\t\t\tfor (let i = 0; i < ts.length; i += 1) {\n\t\t\t\t\tconst t = ts[i];\n\t\t\t\t\tif (t.dataset.src && vs[i]) {\n\t\t\t\t\t\tshow(t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ts, 0, `* 0px ${opts['offset']}px 0px`);\n\t\t}\n\t\t\n\t\tfunction hide(t, blankImage) {\n\t\t\tsaveAttribute(t, 'src', blankImage);\n\t\t\tsaveAttribute(t, 'srcset');\n\t\t\tt.style.opacity = 0;\n\t\t\tconst h = t.getAttribute('height');\n\t\t\tif (h) {\n\t\t\t\tt.style.minHeight = h + 'px';\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction show(t) {\n\t\t\tt.addEventListener('load', () => {\n\t\t\t\tt.style.minHeight = '';\n\t\t\t\tt.style.opacity   = '';\n\t\t\t});\n\t\t\trestoreAttribute(t, 'src');\n\t\t\trestoreAttribute(t, 'srcset');\n\t\t}\n\t\t\n\t\tNS.applyImage = apply;\n\n\t\tNS.isPolyfillNeededForImage = () => isPolyfillNeeded(HTMLImageElement.prototype);\n\t}\n\t{\n\t\t/**\n\t\t *\n\t\t * Iframe\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-12-26\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction apply(ts, opts = {}) {\n\t\t\tif (ts.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\toffset : 100,\n\t\t\t\tdoForce: true,\n\t\t\t}, opts);\n\t\t\n\t\t\tif (isPolyfillNeeded(HTMLIFrameElement.prototype)) {  // For Safari\n\t\t\t\tsetPolyfill(ts, opts);\n\t\t\t} else if (opts['doForce']) {\n\t\t\t\tconst np = ts.filter(e => !e.getAttribute('loading'));\n\t\t\t\tsetPolyfill(np, opts);\n\t\t\t}\n\t\t\n\t\t\twindow.addEventListener('beforeprint', () => {\n\t\t\t\tfor (const t of ts) {\n\t\t\t\t\tif (t.dataset.src) {\n\t\t\t\t\t\tshow(t);\n\t\t\t\t\t}\n\t\t\t\t\tif (t.getAttribute('loading') === 'lazy') {\n\t\t\t\t\t\tt.setAttribute('loading', 'eager');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, false);\n\t\t}\n\t\t\n\t\tfunction setPolyfill(ts, opts) {\n\t\t\tfor (const t of ts) {\n\t\t\t\tconsole.log(t);\n\t\t\t\thide(t);\n\t\t\t}\n\t\t\tonIntersect(vs => {\n\t\t\t\tfor (let i = 0; i < ts.length; i += 1) {\n\t\t\t\t\tconst t = ts[i];\n\t\t\t\t\tif (t.dataset.src && vs[i]) {\n\t\t\t\t\t\tshow(t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ts, 0, `* 0px ${opts['offset']}px 0px`);\n\t\t}\n\t\t\n\t\tfunction hide(t) {\n\t\t\tsaveAttribute(t, 'src');\n\t\t}\n\t\t\n\t\tfunction show(t) {\n\t\t\tconst v = t.dataset['src'];\n\t\t\tif (v) {\n\t\t\t\tif (t.contentDocument) {\n\t\t\t\t\tt.contentDocument.location.replace(v);\n\t\t\t\t} else {\n\t\t\t\t\tt.setAttribute('src', v);\n\t\t\t\t}\n\t\t\t\tdelete t.dataset['src'];\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.applyIframe = apply;\n\n\t\tNS.isPolyfillNeededForIframe = () => isPolyfillNeeded(HTMLIFrameElement.prototype);\n\t}\n\t/**\n\t *\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction saveAttribute(t, at, alt = null) {\n\t\tconst v = t.getAttribute(at);\n\t\tif (v) {\n\t\t\tt.dataset[at] = v;\n\t\t\tif (alt) {\n\t\t\t\tt.setAttribute(at, alt);\n\t\t\t} else {\n\t\t\t\tt.removeAttribute(at);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction restoreAttribute(t, at) {\n\t\tconst v = t.dataset[at];\n\t\tif (v) {\n\t\t\tt.setAttribute(at, v);\n\t\t\tdelete t.dataset[at];\n\t\t}\n\t}\n\t\n\tfunction isPolyfillNeeded(proto) {\n\t\treturn (!('loading' in proto));\n\t}\n\t\n\n})(window['NACSS']['delay']);\n"]}