{"version":3,"sources":["delay-image.js"],"names":["window","NS","hide","t","blankImage","saveAttribute","style","opacity","h","getAttribute","minHeight","show","addEventListener","restoreAttribute","delayImage","ts","opts","length","Object","assign","offset","isPolyfillNeeded","HTMLImageElement","prototype","fn","targets","threshold","rootMargin","vs","Array","fill","tm","Map","init","io","IntersectionObserver","es","e","get","target","isIntersecting","replace","mt","observe","forEach","i","set","st","doFirst","resizeListeners","push","isRunning","args","requestAnimationFrame","throttle","onResize","s","getComputedStyle","document","documentElement","parseInt","scrollPaddingTop","getScrollOffset","clearTimeout","setTimeout","disconnect","onIntersect","dataset","src","setAttribute","delayImageIsNeeded","at","alt","v","removeAttribute","proto","l","passive"],"mappings":"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","file":"delay-image.min.js","sourcesContent":["/**\n *\n * Delay Loading - Image\n *\n * @author Takuto Yanagida\n * @version 2021-11-11\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] || {};\n\n\n(function (NS) {\n\n\t(function () {\n\t\t/**\n\t\t *\n\t\t * Image\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-11\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tconst BLANK_IMG = 'data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=';\n\t\t\n\t\t\n\t\tfunction initialize(ts, opts = {}) {\n\t\t\tif (ts.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\toffset    : 100,\n\t\t\t\tblankImage: BLANK_IMG,\n\t\t\t}, opts);\n\t\t\n\t\t\tif (isPolyfillNeeded(HTMLImageElement.prototype)) {  // For Safari\n\t\t\t\tfor (const t of ts) {\n\t\t\t\t\thide(t, opts['blankImage']);\n\t\t\t\t}\n\t\t\t\tonIntersect(vs => {\n\t\t\t\t\tfor (let i = 0; i < ts.length; i += 1) {\n\t\t\t\t\t\tconst t = ts[i];\n\t\t\t\t\t\tif (t.dataset.src && vs[i]) {\n\t\t\t\t\t\t\tshow(t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, ts, 0, `* 0px ${opts['offset']}px 0px`);\n\t\t\t}\n\t\t\n\t\t\twindow.addEventListener('beforeprint', () => {\n\t\t\t\tfor (const t of ts) {\n\t\t\t\t\tif (t.dataset.src) {\n\t\t\t\t\t\tshow(t);\n\t\t\t\t\t}\n\t\t\t\t\tif (t.getAttribute('loading') === 'lazy') {\n\t\t\t\t\t\tt.setAttribute('loading', 'eager');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, false);\n\t\t}\n\t\t\n\t\tfunction hide(t, blankImage) {\n\t\t\tsaveAttribute(t, 'src', blankImage);\n\t\t\tsaveAttribute(t, 'srcset');\n\t\t\tt.style.opacity = 0;\n\t\t\tconst h = t.getAttribute('height');\n\t\t\tif (h) {\n\t\t\t\tt.style.minHeight = h + 'px';\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction show(t) {\n\t\t\tt.addEventListener('load', () => {\n\t\t\t\tt.style.minHeight = '';\n\t\t\t\tt.style.opacity   = '';\n\t\t\t});\n\t\t\trestoreAttribute(t, 'src');\n\t\t\trestoreAttribute(t, 'srcset');\n\t\t}\n\t\t\n\t\tNS.delayImage         = initialize;\n\t\tNS.delayImageIsNeeded = isPolyfillNeeded;\n\t})();\n\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-17\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s = getComputedStyle(document.documentElement);\n\t\treturn parseInt(s.scrollPaddingTop);\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction onIntersect(fn, targets, threshold = 0, rootMargin ='* 0px 0px 0px') {\n\t\tconst vs = Array(targets.length).fill(false);\n\t\tconst tm = new Map();\n\t\ttargets.forEach((t, i) => tm.set(t, i));\n\t\n\t\tfunction init() {\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\n\t\t\t\tfn(vs);\n\t\t\t}, { rootMargin: rootMargin.replace('*', `${mt}px`), threshold });\n\t\t\tfor (const t of targets) io.observe(t);\n\t\t\treturn io;\n\t\t}\n\t\tlet mt = 0;\n\t\tlet io = null;\n\t\tlet st = null;\n\t\tonResize(() => {\n\t\t\tmt = -getScrollOffset();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\t/**\n\t *\n\t * Common Functions\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction saveAttribute(t, at, alt = null) {\n\t\tconst v = t.getAttribute(at);\n\t\tif (v) {\n\t\t\tt.dataset[at] = v;\n\t\t\tif (alt) {\n\t\t\t\tt.setAttribute(at, alt);\n\t\t\t} else {\n\t\t\t\tt.removeAttribute(at);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction restoreAttribute(t, at) {\n\t\tconst v = t.dataset[at];\n\t\tif (v) {\n\t\t\tt.setAttribute(at, v);\n\t\t\tdelete t.dataset[at];\n\t\t}\n\t}\n\t\n\tfunction isPolyfillNeeded(proto) {\n\t\treturn (!('loading' in proto));\n\t}\n\t\n\n})(window['NACSS']);\n"]}